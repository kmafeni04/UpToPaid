local nttp = require "nttp.nttp"
local html = require "html-nelua.html"

local function change_password(self: *nttp.Server): string
  local el = html.form(
    map!(string, string, {
        id = "change-password",
        ["data-on-submit"] = ("@patch('%s')"):format(self:url_for("change_password")),
    }),
    (do
      local els: sequence(html.Element)
      els:push(html.style(nil, [[
        me {
          display: flex;
          flex-direction: column;
          gap: var(--gap-xs);
        }
      ]]))
      els:push(html.label(map!(string, string, { style = "font-size: var(--font-md); font-weight: 700"}), "Password"))
      els:push(html.div(nil, (do
        local els: sequence(html.Element)
        els:push(html.style(nil, [[
          me {
            display: flex;
            flex-direction: column;
            gap: var(--gap-xs);
          }
        ]]))
        els:push(html.label(map!(string, string, { ["for"] = "old-password" }), "Old Password"))
        els:push(html.input(map!(string, string, {
          class = "input",
          id = "old-password",
          name = "old-password",
          type = "password",
        })))
        els:push(html.label(map!(string, string, { ["for"] = "new-password" }), "New Passoword"))
        els:push(html.input(map!(string, string, {
          class = "input",
          id = "new-password",
          name = "new-password",
          type = "password",
        })))
        els:push(html.label(map!(string, string, { ["for"] = "confirm-new-password" }), "Confirm New Password"))
        els:push(html.input(map!(string, string, {
          class = "input",
          id = "confirm-new-password",
          name = "confirm-new-password",
          type = "password",
        })))
        els:push(html.div(nil, (do
          local els: sequence(html.Element)
          els:push(html.style(nil, [[
            me {
              display: flex;
              gap: var(--gap-xs);

              &.btn{
                width: 50%;
              }
            }
          ]]))
          els:push(html.button(map!(string, string, {
            class = "btn",
            type = "button",
            ["data-on-click"] = ("@get('%s')"):format(self:url_for("cancel_change_password"))
          }), "Cancel"))
          els:push(html.button(map!(string, string, { class = "btn" }), "Submit"))

          in els
        end)))

        in els
      end)))

      in els
    end)
  )
  return el:tostring()
end

return change_password
